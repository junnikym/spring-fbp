<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>...</title>

    <link rel="stylesheet" th:href="@{/assets/css/BeanDependencyNode.css}" />

    <script type="text/javascript" th:src="@{/src/dependency/BeanDependencyNode.js}"></script>
</head>
<body>
    <svg class="bean-dependency-table"
         width="500vw" height="100vh"
         xmlns="http://www.w3.org/2000/svg">

        <!--/*@thymesVar id="beansWithLayer" type="kotlin.collections.Collection"*/-->
        <g class="bean-dependency-layer"
             th:each="beansInLayer : ${beansWithLayer}">

            <!--/*@thymesVar id="data" type="kotlin.collections.Collection"*/-->
            <th:block th:each="bean : ${beansInLayer}"
                      th:include="fragments/BeanDependencyNode :: bean-node(bean)"/>
        </g>
    </svg>

    <script>
        const nodeMap = new Map()
        const nodes = getLayer().map(getNodeFromLayer)

        const nodeGap = 10;

        nodes.forEach((layerList, layerNum) => createNodeInLayer(layerList, layerNum))

        function createNodeInLayer(layerList, layerNum) {
            layerList.forEach((it, idx) => createNode(it, layerNum, idx))
        }
        function createNode(dom, layer, idx) {
            const x = (nodeGap + BeanDependencyNode.DEFAULT_WIDTH) * layer
            const y = (nodeGap + BeanDependencyNode.DEFAULT_HEIGHT) * idx

            const name = dom.id
            const loc = new BeanDependencyNode(dom, x, y)

            nodeMap.set(name, loc)
        }

        function organizeLinkLine(nodes) {
            nodes.map(getLinkWith)
                .forEach()
        }

        function getLayer() {
            return [...document.getElementsByClassName("bean-dependency-layer")]
        }
        function getNodeFromLayer(layer) {
            return [...layer.getElementsByClassName("bean-dependency-node")]
        }
        // function getLinkWith(node) {
        //     return [...node.getElementsByClassName("link-with")]
        // }
    </script>
</body>
</html>
